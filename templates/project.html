{% extends "base.html" %}

{% block title %}{{ project.name }} - Project Organizer{% endblock %}

{% block content %}
<div class="container">
    <div class="project-header">
        <h2>{% if project.implement %}{{ project.implement }}: {% endif %}{{ project.name }}</h2>
        <span class="tag tag-{{ project.tag }}">{{ project.tag }}</span>
    </div>

    <!-- Edit Project Form -->
    <div class="card">
        <h3>Edit Project</h3>
        <form method="POST" action="{{ url_for('edit_project', project_id=project.id) }}">
            <div class="form-group">
                <label for="category_id">Category:</label>
                <select id="category_id" name="category_id" required>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if project.category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="name">Project Name:</label>
                <input type="text" id="name" name="name" value="{{ project.name }}" required>
            </div>

            <div class="form-group">
                <label for="tag">Type:</label>
                <select id="tag" name="tag" required>
                    {% for type in types %}
                    <option value="{{ type.name }}" {% if project.tag == type.name %}selected{% endif %}>{{ type.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="implement">Implement:</label>
                <input type="text" id="implement" name="implement" value="{{ project.implement }}" placeholder="e.g., Tractor, Combine, etc.">
            </div>

            <div class="form-group">
                <label for="information">Information:</label>
                <textarea id="information" name="information" rows="5">{{ project.information }}</textarea>
            </div>

            <button type="submit" class="btn">Update Project</button>
            <button type="submit" class="btn btn-danger" formaction="{{ url_for('delete_project', project_id=project.id) }}" onclick="return confirm('Are you sure you want to delete this project?')">Delete Project</button>
        </form>
    </div>

    <!-- Supplies Needed Section -->
    <div class="card">
        <h3>Supplies Needed</h3>
        <form method="POST" action="{{ url_for('add_supply', project_id=project.id) }}" class="inline-form">
            <input type="text" name="item" placeholder="Add supply item..." required>
            <button type="submit" class="btn btn-sm">Add</button>
        </form>

        <ul class="supply-list">
            {% if project.supplies %}
                {% for supply in project.supplies %}
                <li class="supply-item {% if supply.checked %}checked{% endif %}">
                    <form method="POST" action="{{ url_for('toggle_supply', supply_id=supply.id) }}" class="checkbox-form">
                        <input type="checkbox" {% if supply.checked %}checked{% endif %} onchange="this.form.submit()">
                        <label>{{ supply.item }}</label>
                    </form>
                    <form method="POST" action="{{ url_for('delete_supply', supply_id=supply.id) }}" style="display: inline;">
                        <button type="submit" class="btn-delete">×</button>
                    </form>
                </li>
                {% endfor %}
            {% else %}
                <li class="empty">No supplies listed yet.</li>
            {% endif %}
        </ul>
    </div>

    <!-- Roadblocks/Help Wanted Section -->
    <div class="card">
        <h3>Roadblocks</h3>
        <form method="POST" action="{{ url_for('add_roadblock', project_id=project.id) }}" class="inline-form">
            <textarea name="description" placeholder="Describe a roadblock..." required rows="2"></textarea>
            <button type="submit" class="btn btn-sm">Add</button>
        </form>

        <ul class="item-list">
            {% if project.roadblocks %}
                {% for roadblock in project.roadblocks %}
                <li>
                    {{ roadblock.description }}
                    <form method="POST" action="{{ url_for('delete_roadblock', roadblock_id=roadblock.id) }}" style="display: inline;">
                        <button type="submit" class="btn-delete">×</button>
                    </form>
                    <small class="timestamp">{{ roadblock.username }} - {{ roadblock.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                </li>
                {% endfor %}
            {% else %}
                <li class="empty">No roadblocks listed yet.</li>
            {% endif %}
        </ul>
    </div>

    <!-- Conversation Section -->
    <div class="card">
        <h3>Conversation</h3>
        <form method="POST" action="{{ url_for('add_comment', project_id=project.id) }}" class="inline-form">
            <textarea name="text" placeholder="Add a comment..." required rows="3"></textarea>
            <button type="submit" class="btn btn-sm">Post</button>
        </form>

        <div class="comments-list">
            {% if project.comments %}
                {% for comment in project.comments|reverse %}
                <div class="comment">
                    <div class="comment-text">{{ comment.text }}</div>
                    <small class="timestamp">{{ comment.username }} - {{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                </div>
                {% endfor %}
            {% else %}
                <p class="empty">No comments yet.</p>
            {% endif %}
        </div>
    </div>

    <div class="actions">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Back to All Projects</a>
    </div>
</div>
{% endblock %}
